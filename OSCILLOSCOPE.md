# 📊 示波器功能使用指南

ImageProcessor 现已集成实时数据示波器，可以可视化显示CSV日志中的数值变量变化趋势。

## ✨ 功能特性

- 📈 **多通道显示**：支持同时显示多个变量的波形
- 🎨 **8种配色方案**：自动为每个通道分配不同颜色
- 🔄 **实时更新**：随视频播放自动更新波形
- 📐 **自动缩放**：Y轴可自动调整范围适应数据
- ⏱️ **可调时间窗口**：1-60秒可调节显示范围
- 👁️ **通道开关**：可单独显示/隐藏每个通道
- 📊 **实时数值显示**：图例中显示当前值

## 🚀 使用步骤

### 1. 准备CSV数据文件

确保您的CSV文件包含数值变量。支持的格式参见 [CSV_FORMAT.md](CSV_FORMAT.md)。

示例CSV格式：
```csv
host_recv_iso,log_text_hex,log_text_utf8,温度,速度,电压
2025-10-24 10:00:00.001,48656C6C6F,Hello,25.5,120,3.3
2025-10-24 10:00:00.034,576F726C64,World,26.1,125,3.2
2025-10-24 10:00:00.067,54657374,Test,25.8,118,3.4
```

### 2. 启动程序并加载数据

1. 运行 `run.bat` 或直接运行 `install\bin\imageprocessor.exe`
2. 点击 **"加载日志CSV"** 按钮，选择您的CSV文件
3. 点击 **"📊 示波器"** 按钮打开示波器窗口

### 3. 添加通道

在示波器窗口中：

1. 从 **"选择变量添加通道"** 下拉框中选择要监控的变量（如"温度"）
2. 点击 **"添加通道"** 按钮
3. 重复以上步骤添加更多通道（如"速度"、"电压"等）

### 4. 播放视频查看波形

1. 导入视频文件（如果有）
2. 使用播放控制按钮（上一帧/播放/下一帧）
3. 示波器将自动更新，显示对应帧的数据变化

### 5. 调整显示设置

- **时间窗口**：调整显示的时间范围（1-60秒）
- **自动缩放Y轴**：勾选后Y轴范围自动适应数据
- **显示/隐藏通道**：点击通道列表中的复选框

## 🎯 使用场景

### 场景1：监控传感器数据
```
变量: 温度、湿度、气压
用途: 观察环境参数随时间变化趋势
```

### 场景2：分析运动数据
```
变量: 速度、加速度、角度
用途: 分析机器人或车辆的运动状态
```

### 场景3：调试控制系统
```
变量: 目标值、实际值、误差
用途: 观察PID控制效果
```

### 场景4：电源监控
```
变量: 电压、电流、功率
用途: 监控电源系统稳定性
```

## 💡 功能说明

### 通道管理

- **添加通道**：从CSV变量列表中选择并添加
- **删除选中**：删除当前选中的通道
- **清空全部**：删除所有通道
- **显示开关**：通过复选框控制每个通道的显示/隐藏

### 显示设置

| 设置项 | 说明 | 范围 |
|--------|------|------|
| 时间窗口 | 显示的时间长度 | 1-60秒 |
| 自动缩放Y轴 | 自动调整Y轴范围 | 开/关 |

### 波形显示

- **网格线**：10x10网格方便读数
- **颜色编码**：每个通道使用不同颜色
- **图例**：右上角显示通道名称和当前值
- **坐标轴标签**：X轴为时间（秒），Y轴为数值

## 🔧 技术细节

### 数据解析

- 支持整数、浮点数、科学计数法
- 自动提取字符串中的数字部分
- 容错处理：无法解析的值显示为0

### 时间轴

- 假设视频帧率为30fps
- X轴显示相对时间（单位：秒）
- 自动移除超出时间窗口的旧数据

### 性能优化

- 使用双端队列(deque)高效管理数据点
- 仅保留时间窗口内的数据
- 按需刷新绘图，避免过度渲染

## 📝 注意事项

1. **变量必须是数值**：非数值变量（如纯文本）会显示为0
2. **CSV格式要求**：确保CSV正确加载（参见CSV_FORMAT.md）
3. **内存使用**：大量通道和长时间窗口会增加内存占用
4. **帧率假设**：目前假设视频30fps，未来可能支持自定义

## 🎨 颜色方案

系统预设8种颜色，循环使用：

1. 🔴 红色 (1.0, 0.2, 0.2)
2. 🔵 青色 (0.2, 0.8, 1.0)
3. 🟡 黄色 (1.0, 0.8, 0.2)
4. 🟣 紫色 (0.6, 0.4, 1.0)
5. 🟢 绿色 (0.4, 0.9, 0.5)
6. 🟠 橙色 (1.0, 0.6, 0.3)
7. 🔷 蓝色 (0.3, 0.6, 0.9)
8. 🌸 粉色 (1.0, 0.4, 0.6)

## 🐛 故障排除

### 问题：示波器窗口是空的

**解决方案**：
1. 确认已加载CSV文件
2. 确认CSV中有数值变量
3. 尝试添加通道

### 问题：波形不更新

**解决方案**：
1. 确认视频正在播放或切换帧
2. 检查通道是否被隐藏（复选框未勾选）
3. 检查时间窗口设置是否合理

### 问题：数值显示为0

**解决方案**：
1. 检查CSV中对应列是否包含数值
2. 确认变量名称选择正确
3. 查看CSV_FORMAT.md确认格式正确

## 📚 相关文档

- [CSV_FORMAT.md](CSV_FORMAT.md) - CSV格式说明
- [README.md](README.md) - 主要项目文档
- [README_FULL.md](README_FULL.md) - 完整功能文档

## 🔮 未来计划

- [ ] 支持自定义帧率
- [ ] 导出波形数据
- [ ] 波形缩放和平移
- [ ] 数据点标记和测量
- [ ] 多Y轴支持（不同量纲）
- [ ] 触发和捕获功能
- [ ] FFT频谱分析
- [ ] 统计数据显示（均值、最大、最小）

---

**祝您使用愉快！** 📊✨

如有问题或建议，欢迎反馈。
